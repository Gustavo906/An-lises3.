<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PROSTATS APEX | Titan v40.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&family=JetBrains+Mono:wght@700&display=swap');
        
        :root { --bg: #050507; --card: #0c0c0e; --border: #1a1a1e; --accent: #3b82f6; --win: #10b981; --loss: #ef4444; --draw: #71717a; }
        
        body { background-color: var(--bg); color: #e4e4e7; font-family: 'Inter', sans-serif; }
        .mono { font-family: 'JetBrains Mono', monospace; }

        /* Estilização dos Cards do Grid */
        .game-card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; transition: 0.3s; cursor: pointer; }
        .game-card:hover { border-color: var(--accent); transform: translateY(-3px); }

        /* Modal Customizado */
        #modal { display: none; backdrop-filter: blur(20px); z-index: 1000; }
        #modal.active { display: flex; }

        .modal-content { 
            background: #09090b; border: 1px solid #27272a; 
            width: 100%; max-width: 900px; max-height: 90vh; 
            border-radius: 24px; overflow-y: auto; 
        }

        /* Barra de Probabilidade */
        .prob-bar-bg { height: 6px; background: #18181b; border-radius: 3px; overflow: hidden; margin-top: 8px; }
        .prob-bar-fill { height: 100%; width: 0%; transition: width 1s ease-in-out; }

        /* Item de Histórico */
        .hist-item { 
            display: flex; align-items: center; justify-content: space-between; 
            padding: 10px 14px; background: #121214; border-radius: 12px;
            margin-bottom: 8px; border: 1px solid #1c1c1f;
        }
        .score-pill { 
            padding: 2px 10px; border-radius: 6px; font-size: 11px; font-weight: 800;
            min-width: 45px; text-align: center;
        }
        .bg-win { background: rgba(16, 185, 129, 0.15); color: #10b981; }
        .bg-loss { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .bg-draw { background: rgba(113, 113, 122, 0.15); color: #a1a1aa; }

        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: #27272a; border-radius: 10px; }
    </style>
</head>
<body class="p-0 m-0">

    <nav class="h-16 border-b border-zinc-800 bg-black/50 sticky top-0 backdrop-blur-md z-50 px-6 flex items-center justify-between">
        <div class="flex items-center gap-2">
            <div class="w-2 h-2 bg-blue-500 rounded-full animate-pulse"></div>
            <span class="text-xs font-black tracking-tighter uppercase">Titan <span class="text-blue-500">v40</span></span>
        </div>
        <select id="leagueSelect" onchange="initApp()" class="bg-zinc-900 border border-zinc-800 text-[10px] font-bold px-4 py-2 rounded-full outline-none">
            <option value="PL">PREMIER LEAGUE</option>
            <option value="BSA">BRASILEIRÃO A</option>
            <option value="PD">LA LIGA</option>
            <option value="SA">SERIE A</option>
            <option value="CL">CHAMPIONS LEAGUE</option>
        </select>
    </nav>

    <main class="max-w-6xl mx-auto p-6">
        <div id="statusMsg" class="text-[10px] mono text-zinc-500 mb-6 uppercase tracking-widest">Sincronizando...</div>
        <div id="grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
    </main>

    <!-- MODAL -->
    <div id="modal" class="fixed inset-0 p-4 items-center justify-center bg-black/80">
        <div class="modal-content relative shadow-2xl">
            <!-- Header do Modal -->
            <div class="p-6 border-b border-zinc-800 flex justify-between items-center sticky top-0 bg-[#09090b] z-10">
                <span class="text-[10px] font-black text-zinc-500 uppercase tracking-widest">Relatório Analítico</span>
                <button onclick="closeModal()" class="w-8 h-8 flex items-center justify-center bg-zinc-900 rounded-full text-zinc-400">&times;</button>
            </div>

            <div class="p-6">
                <!-- Banner de Previsão -->
                <div class="bg-gradient-to-br from-zinc-900 to-black border border-zinc-800 rounded-3xl p-8 mb-8 text-center">
                    <div class="flex items-center justify-center gap-8 mb-4">
                        <img id="mLogoH" class="w-16 h-16 object-contain">
                        <div id="mScore" class="text-6xl font-black italic mono tracking-tighter text-white">0-0</div>
                        <img id="mLogoA" class="w-16 h-16 object-contain">
                    </div>
                    <div class="text-[11px] font-bold text-blue-500 uppercase tracking-widest mb-1">Resultado Provável</div>
                    <div id="mVerdict" class="text-xl font-black text-white uppercase italic">Analisando...</div>
                </div>

                <!-- Grid de Dados -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    
                    <!-- Lado Esquerdo: Probabilidades -->
                    <div>
                        <h4 class="text-xs font-black uppercase text-zinc-500 mb-4 flex items-center gap-2">
                            <i class="fa-solid fa-chart-pie"></i> Probabilidades
                        </h4>
                        <div class="space-y-4 bg-zinc-900/30 p-5 rounded-2xl border border-zinc-800">
                            <div>
                                <div class="flex justify-between text-[11px] font-bold uppercase"><span id="mNameH_Prob">Casa</span> <span id="mProbH">0%</span></div>
                                <div class="prob-bar-bg"><div id="mBarH" class="prob-bar-fill bg-blue-500"></div></div>
                            </div>
                            <div>
                                <div class="flex justify-between text-[11px] font-bold uppercase text-zinc-500">Empate <span id="mProbD">0%</span></div>
                                <div class="prob-bar-bg"><div id="mBarD" class="prob-bar-fill bg-zinc-600"></div></div>
                            </div>
                            <div>
                                <div class="flex justify-between text-[11px] font-bold uppercase"><span id="mNameA_Prob">Fora</span> <span id="mProbA">0%</span></div>
                                <div class="prob-bar-bg"><div id="mBarA" class="prob-bar-fill bg-white"></div></div>
                            </div>
                            <div class="grid grid-cols-2 gap-3 pt-2">
                                <div class="bg-zinc-900 p-3 rounded-xl text-center">
                                    <span class="block text-[8px] text-zinc-500 uppercase font-bold">Ambas Marcam</span>
                                    <span id="mBTTS" class="text-sm font-black text-emerald-500">0%</span>
                                </div>
                                <div class="bg-zinc-900 p-3 rounded-xl text-center">
                                    <span class="block text-[8px] text-zinc-500 uppercase font-bold">Over 2.5</span>
                                    <span id="mO25" class="text-sm font-black text-white">0%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Lado Direito: Últimos Jogos -->
                    <div>
                        <h4 class="text-xs font-black uppercase text-zinc-500 mb-4 flex items-center gap-2">
                            <i class="fa-solid fa-clock-rotate-left"></i> Forma Recente
                        </h4>
                        <div class="grid grid-cols-1 gap-6">
                            <div>
                                <div id="mNameH_Hist" class="text-[10px] font-black uppercase mb-3 text-blue-400">Time A</div>
                                <div id="mHistoryH"></div>
                            </div>
                            <div>
                                <div id="mNameA_Hist" class="text-[10px] font-black uppercase mb-3 text-zinc-400">Time B</div>
                                <div id="mHistoryA"></div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = '8e3c0eba984c46a090a5c53c37835285';
        const PROXY = "https://corsproxy.io/?";
        let engine = { table: [], realHistory: {} };

        function cleanName(n) {
            const m = {"Wolverhampton Wanderers": "Wolves", "Manchester United": "Man Utd", "Manchester City": "Man City", "Tottenham Hotspur": "Spurs"};
            return m[n] || n.replace(/\s+FC$|\s+CF$|\s+CD$|\s+United$|\s+City$|\s+Club$|\s+AC$|\s+SC$/gi, '').trim();
        }

        async function studyMatches(league) {
            try {
                const res = await fetch(`${PROXY}https://api.football-data.org/v4/competitions/${league}/matches?status=FINISHED`, { headers: {'X-Auth-Token': API_KEY}});
                const data = await res.json();
                engine.realHistory = {};
                data.matches.slice(-150).forEach(m => {
                    const hId = m.homeTeam.id, aId = m.awayTeam.id;
                    const hScore = m.score.fullTime.home, aScore = m.score.fullTime.away;
                    const hRes = hScore > aScore ? 'V' : (hScore === aScore ? 'E' : 'D');
                    const aRes = aScore > hScore ? 'V' : (aScore === hScore ? 'E' : 'D');
                    
                    if(!engine.realHistory[hId]) engine.realHistory[hId] = [];
                    if(!engine.realHistory[aId]) engine.realHistory[aId] = [];
                    
                    engine.realHistory[hId].push({ score: `${hScore}-${aScore}`, res: hRes, opp: cleanName(m.awayTeam.name) });
                    engine.realHistory[aId].push({ score: `${aScore}-${hScore}`, res: aRes, opp: cleanName(m.homeTeam.name) });
                });
            } catch (e) { console.error(e); }
        }

        function factorial(n) { return n <= 1 ? 1 : n * factorial(n - 1); }
        function poisson(k, lambda) { return (Math.pow(lambda, k) * Math.exp(-lambda)) / factorial(k); }

        async function initApp() {
            const league = document.getElementById('leagueSelect').value;
            const grid = document.getElementById('grid');
            document.getElementById('statusMsg').innerText = "CALCULANDO MATRIZES...";
            
            try {
                await studyMatches(league);
                const [resS, resM] = await Promise.all([
                    fetch(`${PROXY}https://api.football-data.org/v4/competitions/${league}/standings`, { headers: {'X-Auth-Token': API_KEY}}),
                    fetch(`${PROXY}https://api.football-data.org/v4/competitions/${league}/matches?status=SCHEDULED`, { headers: {'X-Auth-Token': API_KEY}})
                ]);
                const sD = await resS.json(); const mD = await resM.json();
                engine.table = sD.standings[0].table;
                document.getElementById('statusMsg').innerText = "TITAN V40 PRONTO";
                
                grid.innerHTML = mD.matches.slice(0, 12).map(m => `
                    <div onclick="openAnalysis(${m.homeTeam.id}, ${m.awayTeam.id})" class="game-card p-5">
                        <div class="flex justify-between items-center mb-6">
                            <span class="text-[9px] mono text-zinc-600 font-bold uppercase">${new Date(m.utcDate).toLocaleDateString('pt-BR')}</span>
                            <span class="px-2 py-0.5 bg-zinc-900 rounded text-[8px] text-zinc-400 font-black">ANALYTICS</span>
                        </div>
                        <div class="space-y-3">
                            <div class="flex items-center gap-3">
                                <img src="${m.homeTeam.crest}" class="w-5 h-5 object-contain">
                                <span class="text-xs font-bold text-white uppercase">${cleanName(m.homeTeam.name)}</span>
                            </div>
                            <div class="flex items-center gap-3">
                                <img src="${m.awayTeam.crest}" class="w-5 h-5 object-contain">
                                <span class="text-xs font-bold text-white uppercase">${cleanName(m.awayTeam.name)}</span>
                            </div>
                        </div>
                    </div>`).join('');
            } catch (e) { document.getElementById('statusMsg').innerText = "API BUSY (RETRY IN 60S)"; }
        }

        function openAnalysis(hId, aId) {
            const h = engine.table.find(t => t.team.id === hId);
            const a = engine.table.find(t => t.team.id === aId);
            if(!h || !a) return;

            const hHist = (engine.realHistory[hId] || []).slice(-5).reverse();
            const aHist = (engine.realHistory[aId] || []).slice(-5).reverse();
            
            const renderHist = (hist) => hist.map(j => `
                <div class="hist-item">
                    <span class="score-pill bg-${j.res === 'V' ? 'win' : j.res === 'D' ? 'loss' : 'draw'} mono">${j.score}</span>
                    <span class="text-[10px] font-medium text-zinc-400">vs ${j.opp}</span>
                </div>`).join('');

            document.getElementById('mHistoryH').innerHTML = renderHist(hHist);
            document.getElementById('mHistoryA').innerHTML = renderHist(aHist);
            
            document.getElementById('mNameH_Hist').innerText = cleanName(h.team.name);
            document.getElementById('mNameA_Hist').innerText = cleanName(a.team.name);
            document.getElementById('mNameH_Prob').innerText = cleanName(h.team.name);
            document.getElementById('mNameA_Prob').innerText = cleanName(a.team.name);

            // Poisson Logic
            const hWeight = 0.8 + ((hHist.filter(x => x.res === 'V').length * 3 + hHist.filter(x => x.res === 'E').length) / 15) * 0.4;
            const aWeight = 0.8 + ((aHist.filter(x => x.res === 'V').length * 3 + aHist.filter(x => x.res === 'E').length) / 15) * 0.4;

            let xGH = (h.goalsFor/h.playedGames) * (a.goalsAgainst/a.playedGames) * hWeight * 1.05;
            let xGA = (a.goalsFor/a.playedGames) * (h.goalsAgainst/h.playedGames) * aWeight;

            let pH=0, pD=0, pA=0, btts=0, o25=0, maxP=-1, bestS="0-0";
            for(let i=0; i<6; i++) {
                for(let j=0; j<6; j++) {
                    let p = poisson(i, xGH) * poisson(j, xGA);
                    if(i>j) pH+=p; else if(i===j) pD+=p; else pA+=p;
                    if(i>0 && j>0) btts+=p;
                    if(i+j > 2.5) o25+=p;
                    if(p > maxP) { maxP=p; bestS=`${i} - ${j}`; }
                }
            }

            document.getElementById('modal').classList.add('active');
            document.getElementById('mScore').innerText = bestS;
            document.getElementById('mLogoH').src = h.team.crest;
            document.getElementById('mLogoA').src = a.team.crest;

            const upd = (id, val, bar) => {
                document.getElementById(id).innerText = (val*100).toFixed(1) + '%';
                if(bar) setTimeout(() => document.getElementById(bar).style.width = (val*100) + '%', 100);
            };
            upd('mProbH', pH, 'mBarH'); upd('mProbD', pD, 'mBarD'); upd('mProbA', pA, 'mBarA');
            upd('mBTTS', btts); upd('mO25', o25);

            const v = document.getElementById('mVerdict');
            if (pH > pA + 0.15) v.innerText = `Favorito: ${cleanName(h.team.name)}`;
            else if (pA > pH + 0.15) v.innerText = `Favorito: ${cleanName(a.team.name)}`;
            else v.innerText = "Equilíbrio / Dupla Chance";
        }

        function closeModal() { 
            document.getElementById('modal').classList.remove('active'); 
            ['mBarH', 'mBarD', 'mBarA'].forEach(b => document.getElementById(b).style.width = '0%');
        }

        window.onload = initApp;
    </script>
</body>
</html>
